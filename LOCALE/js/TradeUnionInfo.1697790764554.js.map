{"version":3,"sources":["webpack:///./vendor/modules/CFPKG-99999-LOCALE/TEST.vue?6fb8","webpack:///./vendor/modules/CFPKG-99999-LOCALE/TEST.vue","webpack:///./vendor/modules/CFPKG-99999-LOCALE/TEST.vue?9363","webpack:///./vendor/modules/CFPKG-99999-LOCALE/TEST.vue?bbb0"],"names":["_withId","_withScopeId","_pushScopeId","_hoisted_1","class","_hoisted_2","_hoisted_3","_createVNode","id","autoplay","playsinline","_hoisted_4","_hoisted_5","_createTextVNode","_hoisted_6","_hoisted_7","_popScopeId","_defineComponent","expose","setup","__props","peerConnection","RTCPeerConnection","iceServers","urls","userId","Math","random","toString","substring","roomId","ref","socket","localStream","remoteStream","offerSdp","initConnect","value","WebSocket","on","handleConnect","reason","connect","ElMessage","warning","data","error","success","emit","sdp","createOffer","createAnswer","addAnswer","init","async","localVideo","document","getElementById","remoteVideo","navigator","mediaDevices","getUserMedia","video","audio","MediaStream","srcObject","getTracks","forEach","track","addTrack","ontrack","event","streams","onicecandidate","candidate","JSON","stringify","localDescription","offer","setLocalDescription","val","parse","setRemoteDescription","answer","answerSdp","currentRemoteDescription","cameraOpen","handleCamera","getVideoTracks","enabled","handleLeave","close","disconnect","onMounted","_ctx","_cache","_component_el_input","_resolveComponent","_component_el_button","_openBlock","_createBlock","modelValue","$event","style","placeholder","clearable","onKeyup","_withKeys","type","onClick","default","_","_toDisplayString","__exports__"],"mappings":"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","file":"js/TradeUnionInfo.1697790764554.js","sourcesContent":["import { defineComponent as _defineComponent } from 'vue'\nimport { createVNode as _createVNode, resolveComponent as _resolveComponent, withKeys as _withKeys, createTextVNode as _createTextVNode, withCtx as _withCtx, toDisplayString as _toDisplayString, openBlock as _openBlock, createBlock as _createBlock, withScopeId as _withScopeId, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\"\nconst _withId = /*#__PURE__*/_withScopeId(\"data-v-7bc2d32d\")\n\n_pushScopeId(\"data-v-7bc2d32d\")\nconst _hoisted_1 = { class: \"content\" }\nconst _hoisted_2 = { class: \"signaling-p2p-container\" }\nconst _hoisted_3 = /*#__PURE__*/_createVNode(\"div\", { class: \"video-container\" }, [\n  /*#__PURE__*/_createVNode(\"div\", { class: \"main-video\" }, [\n    /*#__PURE__*/_createVNode(\"video\", {\n      id: \"remote-video\",\n      class: \"remote-video\",\n      autoplay: \"\",\n      playsinline: \"\"\n    }),\n    /*#__PURE__*/_createVNode(\"div\", { class: \"video-title\" }, \"對方\")\n  ]),\n  /*#__PURE__*/_createVNode(\"div\", { class: \"video-list\" }, [\n    /*#__PURE__*/_createVNode(\"div\", { class: \"video-box\" }, [\n      /*#__PURE__*/_createVNode(\"video\", {\n        id: \"local\",\n        autoplay: \"\",\n        playsinline: \"\"\n      }),\n      /*#__PURE__*/_createVNode(\"div\", { class: \"video-title\" }, \"我\")\n    ])\n  ])\n], -1)\nconst _hoisted_4 = { class: \"operation\" }\nconst _hoisted_5 = /*#__PURE__*/_createTextVNode(\" 房间号： \")\nconst _hoisted_6 = /*#__PURE__*/_createTextVNode(\"加入\")\nconst _hoisted_7 = /*#__PURE__*/_createTextVNode(\"离开\")\n_popScopeId()\n\nimport { ElMessage } from \"element-plus\";\nimport {\n  defineComponent,\n  reactive,\n  toRefs,\n  nextTick,\n  ref,\n  onMounted,\n} from \"vue\";\n\n// import VConsole from 'vconsole'\n// const vConsole = new VConsole()\n\nexport default _defineComponent({\n  expose: [],\n  setup(__props) {\n\nconst peerConnection = new RTCPeerConnection({\n  iceServers: [\n    {\n      urls: \"stun:stun.voipbuster.com \",\n    },\n  ],\n});\nconst userId = Math.random().toString(36).substring(2);\n// const roomId = ref('3333')\nconst roomId = ref(\"\");\nlet socket: WebSocket;\nlet localStream: MediaStream;\nlet remoteStream: MediaStream;\nlet offerSdp = \"\";\n// socket\nconst url = \"wss://webrtc.mirfak.tw?_t=\";\nlet ws;\nconst domain = \"https://webrtc.mirfak.tw\";\nfunction initConnect() {\n  if (!roomId.value) {\n    ElMessage.error(\"请输入房间号\");\n    return;\n  }\n  // socket = io('https://47.95.239.198:3000')\n  socket = new WebSocket(\"https://signaling.fedtop.com\");\n  // socket = io(\"https://signaling.fedtop.com\");\n  // socket = io('https://192.168.1.126:12345')\n  // 连接成功时触发\n  socket.on(\"connect\", () => {\n    handleConnect();\n  });\n  // 断开连接时触发\n  socket.on(\"disconnect\", (reason) => {\n    if (reason === \"io server disconnect\") {\n      // 断线是由服务器发起的，重新连接。\n      socket.connect();\n    }\n    ElMessage.warning(\"您已断开连接\");\n  });\n  // 服务端发送报错信息\n  socket.on(\"error\", (data) => {\n    ElMessage.error(data);\n  });\n  // 当有用户加入房间时触发\n  socket.on(\"welcome\", (data) => {\n    ElMessage.success(\n      data.userId === userId ? \"🦄成功加入房间\" : `🦄${data.userId}加入房间`\n    );\n  });\n  // 当有用户离开房间时触发\n  socket.on(\"leave\", (data) => {\n    ElMessage.warning(\n      data.userId === userId ? \"🦄成功离开房间\" : `🦄${data.userId}离开房间`\n    );\n  });\n  // 当有用户发送消息时触发\n  socket.on(\"message\", (data) => {});\n  // 创建offer,发送给远端\n  socket.on(\"createOffer\", (data) => {\n    // 发送 offer\n    if (offerSdp) {\n      socket.emit(\"offer\", {\n        userId,\n        roomId: roomId.value,\n        sdp: offerSdp,\n      });\n      return;\n    }\n    createOffer();\n  });\n  // 收到offer,创建answer\n  socket.on(\"offer\", (data) => {\n    createAnswer(data.sdp);\n  });\n  // 收到answer,设置远端sdp\n  socket.on(\"answer\", (data) => {\n    addAnswer(data.sdp);\n  });\n}\n// 连接成功\nfunction handleConnect() {\n  socket.emit(\"join\", { userId, roomId: roomId.value });\n}\nconst init = async () => {\n  const localVideo = document.getElementById(\"local\") as HTMLVideoElement;\n  const remoteVideo = document.getElementById(\n    \"remote-video\"\n  ) as HTMLVideoElement;\n  localStream = await navigator.mediaDevices.getUserMedia({\n    video: true,\n    audio: false,\n  });\n  remoteStream = new MediaStream();\n  localVideo.srcObject = localStream;\n  remoteVideo.srcObject = remoteStream;\n  localStream.getTracks().forEach((track) => {\n    peerConnection.addTrack(track, localStream);\n  });\n  peerConnection.ontrack = (event) => {\n    event.streams[0].getTracks().forEach((track) => {\n      remoteStream.addTrack(track);\n    });\n  };\n};\n// 创建 offer\nasync function createOffer() {\n  // 当一个新的offer ICE候选人被创建时触发事件\n  peerConnection.onicecandidate = async (event) => {\n    if (event.candidate) {\n      offerSdp = JSON.stringify(peerConnection.localDescription);\n      // 发送 offer\n      if (offerSdp) {\n        socket.emit(\"offer\", {\n          userId,\n          roomId: roomId.value,\n          sdp: offerSdp,\n        });\n      }\n    }\n  };\n  const offer = await peerConnection.createOffer();\n  await peerConnection.setLocalDescription(offer);\n}\n// 创建 answer\nasync function createAnswer(val: string) {\n  const offer = JSON.parse(val);\n  peerConnection.onicecandidate = async (event) => {\n    // 当一个新的 answer ICE candidate 被创建时\n    if (event.candidate) {\n      socket.emit(\"answer\", {\n        userId,\n        roomId: roomId.value,\n        sdp: JSON.stringify(peerConnection.localDescription),\n      });\n    }\n  };\n  await peerConnection.setRemoteDescription(offer);\n  const answer = await peerConnection.createAnswer();\n  await peerConnection.setLocalDescription(answer);\n}\n// 添加 answer\nasync function addAnswer(answerSdp: string) {\n  const answer = JSON.parse(answerSdp);\n  if (!peerConnection.currentRemoteDescription) {\n    peerConnection.setRemoteDescription(answer);\n  }\n}\n// 打关摄像头\nconst cameraOpen = ref(true);\nfunction handleCamera() {\n  cameraOpen.value = !cameraOpen.value;\n  localStream.getVideoTracks().forEach((track) => {\n    track.enabled = cameraOpen.value;\n  });\n}\n// // 开关麦克风\n// const isAudioOpen = ref(true)\n// function handleMic() {\n//   localStream.getAudioTracks().forEach((track) => {\n//     track.stop()\n//   })\n//   isAudioOpen.value = !isAudioOpen.value\n// }\n// 离开房间\nfunction handleLeave() {\n  // 关闭对等连接\n  peerConnection.close();\n  // 发送离开的消息\n  socket.emit(\"leave\", { userId, roomId: roomId.value });\n  // 关闭socket连接\n  socket.disconnect();\n}\nonMounted(async () => {\n  await init();\n});\n\nreturn (_ctx: any,_cache: any) => {\n  const _component_el_input = _resolveComponent(\"el-input\")\n  const _component_el_button = _resolveComponent(\"el-button\")\n\n  return (_openBlock(), _createBlock(\"div\", _hoisted_1, [\n    _createVNode(\"div\", _hoisted_2, [\n      _hoisted_3,\n      _createVNode(\"div\", _hoisted_4, [\n        _hoisted_5,\n        _createVNode(_component_el_input, {\n          modelValue: roomId.value,\n          \"onUpdate:modelValue\": _cache[1] || (_cache[1] = ($event: any) => (roomId.value = $event)),\n          style: {\"width\":\"150px\",\"margin-right\":\"20px\"},\n          placeholder: \"要加入的房间号\",\n          clearable: \"\",\n          onKeyup: _withKeys(initConnect, [\"enter\"])\n        }, null, 8, [\"modelValue\", \"onKeyup\"]),\n        _createVNode(_component_el_button, {\n          type: \"primary\",\n          onClick: initConnect\n        }, {\n          default: _withId(() => [\n            _hoisted_6\n          ]),\n          _: 1\n        }),\n        _createVNode(_component_el_button, {\n          type: cameraOpen.value ? 'warning' : 'primary',\n          onClick: handleCamera\n        }, {\n          default: _withId(() => [\n            _createTextVNode(_toDisplayString(cameraOpen.value ? \"关闭\" : \"打开\") + \"视频\", 1)\n          ]),\n          _: 1\n        }, 8, [\"type\"]),\n        _createVNode(_component_el_button, {\n          type: \"danger\",\n          onClick: handleLeave\n        }, {\n          default: _withId(() => [\n            _hoisted_7\n          ]),\n          _: 1\n        })\n      ])\n    ])\n  ]))\n}\n}\n\n})","import script from \"./TEST.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./TEST.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./TEST.vue?vue&type=style&index=0&id=7bc2d32d&lang=scss&scoped=true\"\nimport \"./TEST.vue?vue&type=style&index=1&id=7bc2d32d&lang=css\"\n\nimport exportComponent from \"D:\\\\nick\\\\Fuji\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-7bc2d32d\"]])\n\nexport default __exports__","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./TEST.vue?vue&type=style&index=0&id=7bc2d32d&lang=scss&scoped=true\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./TEST.vue?vue&type=style&index=1&id=7bc2d32d&lang=css\""],"sourceRoot":""}